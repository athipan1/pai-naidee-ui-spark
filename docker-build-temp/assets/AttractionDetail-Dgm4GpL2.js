import{j as e}from"./ui-CYJXyMFH.js";import{r as s}from"./vendor-BtPQM8GQ.js";import{B as a,C as t,d as n}from"./index-B3OkbNa5.js";import{D as r,a as l,b as i,c as o}from"./dropdown-menu-CGE9erBO.js";import{B as c}from"./badge-MTT6vMtQ.js";import{_ as m}from"./three-Bx_9lKOs.js";import"./mockData-yCUV551o.js";import{D as d,a as x,b as h,c as f}from"./dialog-CtiMXqrs.js";import{X as p,N as u,n as j,af as g,d as N,S as w,ag as v,H as b,R as k,A as y,e as L,i as C,$ as T,f as A,a1 as S,ah as D}from"./icons-Dm8dLJzq.js";import{c as F,L as M,d as E,u as I}from"./router-BKNbbwl4.js";import{O}from"./OptimizedImage-afipJHCM.js";import{a as $,b as B,g as _}from"./useAttractionQueries-BuAHFOVJ.js";import"./query-CekFPK04.js";const z=()=>localStorage.getItem("authToken"),P=()=>{localStorage.removeItem("authToken"),localStorage.removeItem("refreshToken")},R=()=>{const e=z();return{"Content-Type":"application/json",...e&&{Authorization:`Bearer ${e}`}}},U=async(e,s={},a=!0)=>{let t=z();if(t&&(e=>{try{return 1e3*JSON.parse(atob(e.split(".")[1])).exp<Date.now()}catch{return!0}})(t)){const e=await W();if(!e)throw P(),window.location.href="/login",new Error("กรุณาเข้าสู่ระบบใหม่ (token หมดอายุ)");t=e,s.headers={...s.headers,Authorization:`Bearer ${t}`}}const n=await fetch(e,{...s,headers:{...R(),...s.headers||{}}});if(!n.ok){if(401===n.status&&a)throw P(),window.location.href="/login",new Error("กรุณาเข้าสู่ระบบใหม่ (401)");const e=await n.text();throw new Error(e||"เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง")}return n.json()},W=async()=>{const e=localStorage.getItem("refreshToken");if(!e)return null;try{const s=await fetch("http://localhost:5000/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:e})});if(!s.ok)return null;const a=await s.json();return a.authToken?(((e,s)=>{localStorage.setItem("authToken",e),s&&localStorage.setItem("refreshToken",s)})(a.authToken,a.refreshToken),a.authToken):null}catch{return null}},H=async e=>{try{return await U(`/accommodations/nearby/${e}`)}catch{const{mockAccommodations:s,simulateDelay:a}=await m(async()=>{const{mockAccommodations:e,simulateDelay:s}=await import("./mockData-yCUV551o.js");return{mockAccommodations:e,simulateDelay:s}},[]);await a(800);return s[e]||[]}},V=({isOpen:s,onClose:t,location:n,currentLanguage:r})=>{const l={th:{mapTitle:"ตำแหน่งบนแผนที่",navigateExternal:"นำทางด้วยแอปแผนที่ภายนอก",viewLocation:"ดูตำแหน่ง",close:"ปิด"},en:{mapTitle:"Location on Map",navigateExternal:"Navigate with External Map App",viewLocation:"View Location",close:"Close"}}[r],i="th"===r&&n.nameLocal?n.nameLocal:n.name;return e.jsx(d,{open:s,onOpenChange:t,children:e.jsxs(x,{className:"max-w-4xl h-[80vh] p-0",children:[e.jsx(h,{className:"p-6 pb-0",children:e.jsxs(f,{className:"flex items-center justify-between",children:[e.jsx("span",{children:l.mapTitle}),e.jsx(a,{variant:"ghost",size:"sm",onClick:t,children:e.jsx(p,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"flex-1 relative p-6 pt-0",children:[e.jsx("div",{className:"h-96 w-full rounded-lg overflow-hidden border bg-muted flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(u,{className:"w-8 h-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:i}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["📍 ",n.lat.toFixed(6),", ",n.lng.toFixed(6)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(a,{onClick:()=>{alert(`ตำแหน่ง ${i}\nพิกัด: ${n.lat}, ${n.lng}`)},variant:"outline",className:"flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4"}),l.viewLocation]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Interactive map will load here"})]})]})}),e.jsx("div",{className:"flex justify-center mt-4 gap-3",children:e.jsxs(a,{onClick:()=>{alert(`นำทางไปยัง ${i} - พิกัด: ${n.lat}, ${n.lng}`)},size:"lg",className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-5 h-5"}),l.navigateExternal]})})]})]})})},J=({isOpen:s,onClose:r,accommodations:l,loading:i,error:o,currentLanguage:m,attractionName:p})=>{const u={th:{modalTitle:"🏨 ที่พักใกล้เคียง",near:"ใกล้",km:"กม.",from:"จาก",bookNow:"จองเลย",noAccommodations:"ไม่พบที่พักใกล้เคียง",error:"เกิดข้อผิดพลาดในการโหลดข้อมูลที่พัก",loading:"กำลังค้นหาที่พัก...",close:"ปิด",baht:"บาท",perNight:"/คืน"},en:{modalTitle:"🏨 Nearby Accommodations",near:"near",km:"km",from:"from",bookNow:"Book Now",noAccommodations:"No accommodations found nearby",error:"Error loading accommodation data",loading:"Searching for accommodations...",close:"Close",baht:"THB",perNight:"/night"}}[m],v=s=>{const a=[],t=Math.floor(s),n=s%1!=0;for(let l=0;l<t;l++)a.push(e.jsx(w,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"},l));n&&a.push(e.jsx(w,{className:"h-4 w-4 fill-yellow-400/50 text-yellow-400"},"half"));const r=5-Math.ceil(s);for(let l=0;l<r;l++)a.push(e.jsx(w,{className:"h-4 w-4 text-muted-foreground"},`empty-${l}`));return a},b=e=>"th"===m&&e.nameLocal?e.nameLocal:e.name;return e.jsx(d,{open:s,onOpenChange:r,children:e.jsxs(x,{className:"max-w-4xl max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsx(h,{children:e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-5 w-5"}),u.modalTitle," ",u.near," ",p]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-1",children:[i&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:u.loading})]})}),o&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 mb-4",children:u.error}),e.jsx(a,{variant:"outline",onClick:r,children:u.close})]})}),!i&&!o&&0===l.length&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(g,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:u.noAccommodations})]})}),!i&&!o&&l.length>0&&e.jsx("div",{className:"space-y-4",children:l.map(s=>e.jsx(t,{className:"overflow-hidden",children:e.jsx(n,{className:"p-0",children:e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsx("div",{className:"sm:w-48 h-48 sm:h-32 relative overflow-hidden",children:e.jsx("img",{src:s.image,alt:b(s),className:"w-full h-full object-cover"})}),e.jsx("div",{className:"flex-1 p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:b(s)}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[v(s.rating),e.jsx("span",{className:"text-sm font-medium ml-1",children:s.rating})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(N,{className:"h-3 w-3"}),e.jsxs("span",{children:[s.distance," ",u.km," ",u.from," ",p]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mb-3",children:[s.amenities.slice(0,3).map(s=>e.jsx(c,{variant:"secondary",className:"text-xs",children:s},s)),s.amenities.length>3&&e.jsxs(c,{variant:"secondary",className:"text-xs",children:["+",s.amenities.length-3]})]})]}),e.jsxs("div",{className:"sm:text-right",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"text-xl font-bold text-primary",children:[s.price.toLocaleString()," ",u.baht]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:u.perNight})]}),e.jsxs(a,{onClick:()=>(e=>{const s=e.booking_url||`https://www.booking.com/search?ss=${encodeURIComponent(e.name)}`;window.open(s,"_blank")})(s),className:"w-full sm:w-auto flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-4"}),u.bookNow]})]})]})})]})})},s.id))})]})]})})},q=({currentLanguage:s,items:a})=>{const t=F(),n=a||(()=>{const e=t.pathname.split("/").filter(Boolean),a=[{label:"th"===s?"หน้าแรก":"Home",path:"/"}];return 0===e.length||("attraction"===e[0]?(a.push({label:"th"===s?"สถานที่ท่องเที่ยว":"Attractions",path:"/"}),e[1]&&a.push({label:"th"===s?"รายละเอียด":"Details"})):"category"===e[0]?(a.push({label:"th"===s?"หมวดหมู่":"Categories",path:"/"}),e[1]&&a.push({label:e[1].charAt(0).toUpperCase()+e[1].slice(1)})):"explore"===e[0]?a.push({label:"th"===s?"สำรวจ":"Explore"}):"favorites"===e[0]?a.push({label:"th"===s?"รายการโปรด":"Favorites"}):"profile"===e[0]?a.push({label:"th"===s?"โปรไฟล์":"Profile"}):"map"===e[0]&&a.push({label:"th"===s?"แผนที่":"Map"})),a})();return"/"!==t.pathname||a?e.jsx("nav",{"aria-label":"Breadcrumb",className:"py-2 px-4 bg-background/80 backdrop-blur-sm border-b border-border/30",children:e.jsx("ol",{className:"flex items-center space-x-2 text-sm",children:n.map((s,a)=>{const t=a===n.length-1,r=0===a;return e.jsxs("li",{className:"flex items-center",children:[a>0&&e.jsx(v,{className:"w-4 h-4 text-muted-foreground mx-2"}),s.path&&!t?e.jsxs(M,{to:s.path,className:"flex items-center text-muted-foreground hover:text-primary transition-colors",children:[r&&e.jsx(b,{className:"w-4 h-4 mr-1"}),s.label]}):e.jsxs("span",{className:"flex items-center "+(t?"text-foreground font-medium":"text-muted-foreground"),children:[r&&e.jsx(b,{className:"w-4 h-4 mr-1"}),s.label]})]},a)})})}):null},G=({currentLanguage:m,onBack:d})=>{var x,h;const{id:f}=E(),p=I(),{data:v,isLoading:b,error:F,refetch:M}=$(f),z=B(),[P,R]=s.useState(!1),[U,W]=s.useState(0),[G,Q]=s.useState(!1),[K,X]=s.useState(!1),[Y,Z]=s.useState([]),[ee,se]=s.useState(!1),[ae,te]=s.useState(null),ne={th:{loading:"กำลังโหลด...",backToSearch:"กลับ",addToFavorites:"เพิ่มรายการโปรด",removeFromFavorites:"ลบออกจากรายการโปรด",notFound:"ไม่พบสถานที่ท่องเที่ยวนี้",mapView:"🗺️ แผนที่",navigateToMap:"🧭 นำทาง",mapAndNavigate:"🗺️ แผนที่ & นำทาง",viewMap:"ดูแผนที่",getDirections:"เส้นทาง",bookAccommodation:"🏨 จองที่พักใกล้เคียง",externalLinks:"🔗 ลิงก์ที่เกี่ยวข้อง",externalLinksDescription:"เข้าถึงข้อมูลเพิ่มเติมและแหล่งข้อมูลอย่างเป็นทางการ",officialWebsite:"🌐 เว็บไซต์อย่างเป็นทางการ",wikipediaInfo:"📖 ข้อมูลเพิ่มเติม",refreshData:"🔄 รีเฟรชข้อมูล",refreshing:"กำลังรีเฟรช...",refreshSuccess:"รีเฟรชข้อมูลสำเร็จ",refreshError:"เกิดข้อผิดพลาดในการรีเฟรช",dataUpdated:"ข้อมูลได้รับการอัปเดตแล้ว"},en:{loading:"Loading...",backToSearch:"Back",addToFavorites:"Add to Favorites",removeFromFavorites:"Remove from Favorites",notFound:"Attraction not found",mapView:"🗺️ Map",navigateToMap:"🧭 Navigate",mapAndNavigate:"🗺️ Map & Navigate",viewMap:"View Map",getDirections:"Get Directions",bookAccommodation:"🏨 Book Nearby Accommodation",externalLinks:"🔗 Related Links",externalLinksDescription:"Access additional information and official resources",officialWebsite:"🌐 Official Website",wikipediaInfo:"📖 More Information",refreshData:"🔄 Refresh Data",refreshing:"Refreshing...",refreshSuccess:"Data refreshed successfully",refreshError:"Failed to refresh data",dataUpdated:"Data has been updated"}}[m];if(b)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:ne.loading})]})});if(F)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl text-muted-foreground mb-4",children:_(F,ne.notFound)}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(a,{onClick:()=>p("/"),variant:"outline",children:ne.backToSearch}),e.jsxs(a,{onClick:()=>M(),className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),ne.refreshData]})]})]})});if(!v)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl text-muted-foreground",children:ne.notFound}),e.jsx(a,{onClick:()=>p("/"),className:"mt-4",children:ne.backToSearch})]})});const re="th"===m&&v.nameLocal?v.nameLocal:v.name;return e.jsxs("div",{className:"min-h-screen bg-background overflow-x-hidden",children:[e.jsx("div",{className:"sticky top-0 z-40 bg-background/80 backdrop-blur-md border-b",children:e.jsx("div",{className:"container mx-auto px-4 py-3 max-w-full overflow-hidden",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs(a,{variant:"ghost",onClick:d,className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(y,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:ne.backToSearch}),e.jsx("span",{className:"sm:hidden",children:"Back"})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 overflow-hidden",children:[e.jsxs(a,{variant:"ghost",onClick:async()=>{if(f)try{await z.mutateAsync(f)}catch{}},disabled:z.isPending,className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",title:ne.refreshData,children:[e.jsx(k,{className:"w-4 h-4 "+(z.isPending?"animate-spin":"")}),e.jsx("span",{className:"hidden lg:inline",children:z.isPending?ne.refreshing:ne.refreshData})]}),e.jsxs(r,{children:[e.jsx(l,{asChild:!0,children:e.jsxs(a,{variant:"outline",className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:ne.mapAndNavigate}),e.jsx("span",{className:"md:hidden",children:"Map"}),e.jsx(C,{className:"w-3 h-3"})]})}),e.jsxs(i,{align:"end",className:"w-48",children:[e.jsxs(o,{onClick:()=>Q(!0),children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),ne.viewMap]}),e.jsxs(o,{onClick:()=>{if(!(null==v?void 0:v.coordinates))return;const{lat:e,lng:s}=v.coordinates,a=`https://www.google.com/maps/dir/?api=1&destination=${e},${s}`;window.open(a,"_blank","noopener,noreferrer")},children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),ne.getDirections]})]})]}),e.jsx(a,{variant:"ghost",onClick:()=>p("/admin"),className:"flex items-center gap-1 sm:gap-2 flex-shrink-0 hidden sm:flex",title:"th"===m?"แผงควบคุมผู้ดูแลระบบ":"Admin Panel",children:e.jsx(T,{className:"w-4 h-4"})}),e.jsxs(a,{variant:P?"default":"outline",onClick:()=>{R(!P)},className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[e.jsx(A,{className:"w-4 h-4 "+(P?"fill-current":"")}),e.jsx("span",{className:"hidden lg:inline",children:P?ne.removeFromFavorites:ne.addToFavorites})]})]})]})})}),e.jsx(q,{currentLanguage:m,items:[{label:"th"===m?"หน้าแรก":"Home",path:"/"},{label:"th"===m?"สถานที่ท่องเที่ยว":"Attractions",path:"/"},{label:re}]}),e.jsxs("div",{className:"relative h-96 overflow-hidden",children:[e.jsx(O,{src:v.images[U],alt:re,className:"w-full h-full object-cover",width:"100%",height:"384",fallbackSrc:v.images[0]!==v.images[U]?v.images[0]:void 0}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"}),v.images.length>1&&e.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2",children:v.images.map((s,a)=>e.jsx("button",{onClick:()=>W(a),className:"w-3 h-3 rounded-full transition-colors "+(a===U?"bg-white":"bg-white/50")},a))}),e.jsxs("div",{className:"absolute bottom-6 left-6 text-white",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:re}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"w-4 h-4"}),e.jsx("span",{children:v.province})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-4 h-4 fill-current text-yellow-400"}),e.jsx("span",{children:v.rating}),e.jsxs("span",{className:"opacity-75",children:["(",v.reviewCount," reviews)"]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:v.tags.map((s,a)=>e.jsx(c,{variant:"secondary",className:"bg-white/20 text-white border-white/30",children:s},a))})]})]}),e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-full overflow-hidden",children:[e.jsx(t,{className:"mb-8",children:e.jsx(n,{className:"p-6",children:e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:v.description})})}),v.externalLinks&&e.jsx(t,{className:"mb-8",children:e.jsxs(n,{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2 flex items-center gap-2",children:[e.jsx(j,{className:"h-5 w-5 text-primary"}),ne.externalLinks]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:ne.externalLinksDescription})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[v.externalLinks.officialWebsite&&e.jsxs(a,{variant:"outline",className:"flex items-center gap-2 h-auto p-4 text-left justify-start",onClick:()=>window.open(v.externalLinks.officialWebsite,"_blank"),children:[e.jsx(S,{className:"h-4 w-4 text-primary flex-shrink-0"}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium",children:ne.officialWebsite}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"th"===m?"เว็บไซต์หลัก":"Official information"})]})]}),v.externalLinks.wikipediaUrl&&e.jsxs(a,{variant:"outline",className:"flex items-center gap-2 h-auto p-4 text-left justify-start",onClick:()=>window.open(v.externalLinks.wikipediaUrl,"_blank"),children:[e.jsx(D,{className:"h-4 w-4 text-primary flex-shrink-0"}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium",children:ne.wikipediaInfo}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"th"===m?"ข้อมูลเชิงลึก":"Detailed information"})]})]})]})]})}),e.jsx(t,{className:"mb-8",children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2 flex items-center gap-2",children:[e.jsx(g,{className:"h-5 w-5 text-primary"}),ne.bookAccommodation]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"th"===m?"ค้นหาและจองที่พักใกล้เคียงกับสถานที่ท่องเที่ยวนี้":"Find and book accommodations near this attraction"})]}),e.jsxs(a,{onClick:async()=>{if(v){X(!0),se(!0),te(null);try{const e=await H(v.id);Z(e)}catch(e){te(e instanceof Error?e.message:"Failed to load accommodations")}finally{se(!1)}}},className:"flex items-center gap-2",size:"lg",children:[e.jsx(g,{className:"w-5 h-5"}),"th"===m?"ค้นหาที่พัก":"Find Hotels"]})]})})})]}),e.jsx(V,{isOpen:G,onClose:()=>Q(!1),location:{lat:(null==(x=v.coordinates)?void 0:x.lat)||0,lng:(null==(h=v.coordinates)?void 0:h.lng)||0,name:v.name,nameLocal:v.nameLocal},currentLanguage:m}),e.jsx(J,{isOpen:K,onClose:()=>X(!1),accommodations:Y,loading:ee,error:ae,currentLanguage:m,attractionName:v.name})]})};export{G as default};
