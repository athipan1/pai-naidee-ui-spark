var e=Object.defineProperty,t=(t,n,i)=>((t,n,i)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i)(t,"symbol"!=typeof n?n+"":n,i);import{simulateDelay as n,locationExpansionMap as i,mockPosts as r,mockLocations as s}from"./mockData-yCUV551o.js";function o(e){return Array.isArray?Array.isArray(e):"[object Array]"===d(e)}function a(e){return"string"==typeof e}function c(e){return"number"==typeof e}function u(e){return!0===e||!1===e||function(e){return h(e)&&null!==e}(e)&&"[object Boolean]"==d(e)}function h(e){return"object"==typeof e}function l(e){return null!=e}function g(e){return!e.trim().length}function d(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const f=Object.prototype.hasOwnProperty;class p{constructor(e){this._keys=[],this._keyMap={};let t=0;e.forEach(e=>{let n=m(e);this._keys.push(n),this._keyMap[n.id]=n,t+=n.weight}),this._keys.forEach(e=>{e.weight/=t})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function m(e){let t=null,n=null,i=null,r=1,s=null;if(a(e)||o(e))i=e,t=A(e),n=C(e);else{if(!f.call(e,"name"))throw new Error((e=>`Missing ${e} property in key`)("name"));const o=e.name;if(i=o,f.call(e,"weight")&&(r=e.weight,r<=0))throw new Error((e=>`Property 'weight' in key '${e}' must be a positive integer`)(o));t=A(o),n=C(o),s=e.getFn}return{path:t,id:n,weight:r,src:i,getFn:s}}function A(e){return o(e)?e:e.split(".")}function C(e){return o(e)?e.join("."):e}var y={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,t)=>e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1,includeMatches:!1,findAllMatches:!1,minMatchCharLength:1,location:0,threshold:.6,distance:100,...{useExtendedSearch:!1,getFn:function(e,t){let n=[],i=!1;const r=(e,t,s)=>{if(l(e))if(t[s]){const h=e[t[s]];if(!l(h))return;if(s===t.length-1&&(a(h)||c(h)||u(h)))n.push(function(e){return null==e?"":function(e){if("string"==typeof e)return e;let t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)}(h));else if(o(h)){i=!0;for(let e=0,n=h.length;e<n;e+=1)r(h[e],t,s+1)}else t.length&&r(h,t,s+1)}else n.push(e)};return r(e,a(t)?t.split("."):t,0),i?n:n[0]},ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1}};const E=/[^ ]+/g;class M{constructor({getFn:e=y.getFn,fieldNormWeight:t=y.fieldNormWeight}={}){this.norm=function(e=1,t=3){const n=new Map,i=Math.pow(10,t);return{get(t){const r=t.match(E).length;if(n.has(r))return n.get(r);const s=1/Math.pow(r,.5*e),o=parseFloat(Math.round(s*i)/i);return n.set(r,o),o},clear(){n.clear()}}}(t,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((e,t)=>{this._keysMap[e.id]=t})}create(){!this.isCreated&&this.docs.length&&(this.isCreated=!0,a(this.docs[0])?this.docs.forEach((e,t)=>{this._addString(e,t)}):this.docs.forEach((e,t)=>{this._addObject(e,t)}),this.norm.clear())}add(e){const t=this.size();a(e)?this._addString(e,t):this._addObject(e,t)}removeAt(e){this.records.splice(e,1);for(let t=e,n=this.size();t<n;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(e,t){return e[this._keysMap[t]]}size(){return this.records.length}_addString(e,t){if(!l(e)||g(e))return;let n={v:e,i:t,n:this.norm.get(e)};this.records.push(n)}_addObject(e,t){let n={i:t,$:{}};this.keys.forEach((t,i)=>{let r=t.getFn?t.getFn(e):this.getFn(e,t.path);if(l(r))if(o(r)){let e=[];const t=[{nestedArrIndex:-1,value:r}];for(;t.length;){const{nestedArrIndex:n,value:i}=t.pop();if(l(i))if(a(i)&&!g(i)){let t={v:i,i:n,n:this.norm.get(i)};e.push(t)}else o(i)&&i.forEach((e,n)=>{t.push({nestedArrIndex:n,value:e})})}n.$[i]=e}else if(a(r)&&!g(r)){let e={v:r,n:this.norm.get(r)};n.$[i]=e}}),this.records.push(n)}toJSON(){return{keys:this.keys,records:this.records}}}function F(e,t,{getFn:n=y.getFn,fieldNormWeight:i=y.fieldNormWeight}={}){const r=new M({getFn:n,fieldNormWeight:i});return r.setKeys(e.map(m)),r.setSources(t),r.create(),r}function x(e,{errors:t=0,currentLocation:n=0,expectedLocation:i=0,distance:r=y.distance,ignoreLocation:s=y.ignoreLocation}={}){const o=t/e.length;if(s)return o;const a=Math.abs(i-n);return r?o+a/r:a?1:o}const S=32;function w(e,t,n,{location:i=y.location,distance:r=y.distance,threshold:s=y.threshold,findAllMatches:o=y.findAllMatches,minMatchCharLength:a=y.minMatchCharLength,includeMatches:c=y.includeMatches,ignoreLocation:u=y.ignoreLocation}={}){if(t.length>S)throw new Error(`Pattern length exceeds max of ${S}.`);const h=t.length,l=e.length,g=Math.max(0,Math.min(i,l));let d=s,f=g;const p=a>1||c,m=p?Array(l):[];let A;for(;(A=e.indexOf(t,f))>-1;){let e=x(t,{currentLocation:A,expectedLocation:g,distance:r,ignoreLocation:u});if(d=Math.min(e,d),f=A+h,p){let e=0;for(;e<h;)m[A+e]=1,e+=1}}f=-1;let C=[],E=1,M=h+l;const F=1<<h-1;for(let y=0;y<h;y+=1){let i=0,s=M;for(;i<s;){x(t,{errors:y,currentLocation:g+s,expectedLocation:g,distance:r,ignoreLocation:u})<=d?i=s:M=s,s=Math.floor((M-i)/2+i)}M=s;let a=Math.max(1,g-s+1),c=o?l:Math.min(g+s,l)+h,A=Array(c+2);A[c+1]=(1<<y)-1;for(let o=c;o>=a;o-=1){let i=o-1,s=n[e.charAt(i)];if(p&&(m[i]=+!!s),A[o]=(A[o+1]<<1|1)&s,y&&(A[o]|=(C[o+1]|C[o])<<1|1|C[o+1]),A[o]&F&&(E=x(t,{errors:y,currentLocation:i,expectedLocation:g,distance:r,ignoreLocation:u}),E<=d)){if(d=E,f=i,f<=g)break;a=Math.max(1,2*g-f)}}if(x(t,{errors:y+1,currentLocation:g,expectedLocation:g,distance:r,ignoreLocation:u})>d)break;C=A}const w={isMatch:f>=0,score:Math.max(.001,E)};if(p){const e=function(e=[],t=y.minMatchCharLength){let n=[],i=-1,r=-1,s=0;for(let o=e.length;s<o;s+=1){let o=e[s];o&&-1===i?i=s:o||-1===i||(r=s-1,r-i+1>=t&&n.push([i,r]),i=-1)}return e[s-1]&&s-i>=t&&n.push([i,s-1]),n}(m,a);e.length?c&&(w.indices=e):w.isMatch=!1}return w}function D(e){let t={};for(let n=0,i=e.length;n<i;n+=1){const r=e.charAt(n);t[r]=(t[r]||0)|1<<i-n-1}return t}const L=String.prototype.normalize?e=>e.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):e=>e;class B{constructor(e,{location:t=y.location,threshold:n=y.threshold,distance:i=y.distance,includeMatches:r=y.includeMatches,findAllMatches:s=y.findAllMatches,minMatchCharLength:o=y.minMatchCharLength,isCaseSensitive:a=y.isCaseSensitive,ignoreDiacritics:c=y.ignoreDiacritics,ignoreLocation:u=y.ignoreLocation}={}){if(this.options={location:t,threshold:n,distance:i,includeMatches:r,findAllMatches:s,minMatchCharLength:o,isCaseSensitive:a,ignoreDiacritics:c,ignoreLocation:u},e=a?e:e.toLowerCase(),e=c?L(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const h=(e,t)=>{this.chunks.push({pattern:e,alphabet:D(e),startIndex:t})},l=this.pattern.length;if(l>S){let e=0;const t=l%S,n=l-t;for(;e<n;)h(this.pattern.substr(e,S),e),e+=S;if(t){const e=l-S;h(this.pattern.substr(e),e)}}else h(this.pattern,0)}searchIn(e){const{isCaseSensitive:t,ignoreDiacritics:n,includeMatches:i}=this.options;if(e=t?e:e.toLowerCase(),e=n?L(e):e,this.pattern===e){let t={isMatch:!0,score:0};return i&&(t.indices=[[0,e.length-1]]),t}const{location:r,distance:s,threshold:o,findAllMatches:a,minMatchCharLength:c,ignoreLocation:u}=this.options;let h=[],l=0,g=!1;this.chunks.forEach(({pattern:t,alphabet:n,startIndex:d})=>{const{isMatch:f,score:p,indices:m}=w(e,t,n,{location:r+d,distance:s,threshold:o,findAllMatches:a,minMatchCharLength:c,includeMatches:i,ignoreLocation:u});f&&(g=!0),l+=p,f&&m&&(h=[...h,...m])});let d={isMatch:g,score:g?l/this.chunks.length:1};return g&&i&&(d.indices=h),d}}class v{constructor(e){this.pattern=e}static isMultiMatch(e){return I(e,this.multiRegex)}static isSingleMatch(e){return I(e,this.singleRegex)}search(){}}function I(e,t){const n=e.match(t);return n?n[1]:null}class b extends v{constructor(e,{location:t=y.location,threshold:n=y.threshold,distance:i=y.distance,includeMatches:r=y.includeMatches,findAllMatches:s=y.findAllMatches,minMatchCharLength:o=y.minMatchCharLength,isCaseSensitive:a=y.isCaseSensitive,ignoreDiacritics:c=y.ignoreDiacritics,ignoreLocation:u=y.ignoreLocation}={}){super(e),this._bitapSearch=new B(e,{location:t,threshold:n,distance:i,includeMatches:r,findAllMatches:s,minMatchCharLength:o,isCaseSensitive:a,ignoreDiacritics:c,ignoreLocation:u})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class _ extends v{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let t,n=0;const i=[],r=this.pattern.length;for(;(t=e.indexOf(this.pattern,n))>-1;)n=t+r,i.push([t,n-1]);const s=!!i.length;return{isMatch:s,score:s?0:1,indices:i}}}const R=[class extends v{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}},_,class extends v{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}},class extends v{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},class extends v{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},class extends v{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}},class extends v{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const t=-1===e.indexOf(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}},b],k=R.length,N=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/;const q=new Set([b.type,_.type]);class ${constructor(e,{isCaseSensitive:t=y.isCaseSensitive,ignoreDiacritics:n=y.ignoreDiacritics,includeMatches:i=y.includeMatches,minMatchCharLength:r=y.minMatchCharLength,ignoreLocation:s=y.ignoreLocation,findAllMatches:o=y.findAllMatches,location:a=y.location,threshold:c=y.threshold,distance:u=y.distance}={}){this.query=null,this.options={isCaseSensitive:t,ignoreDiacritics:n,includeMatches:i,minMatchCharLength:r,findAllMatches:o,ignoreLocation:s,location:a,threshold:c,distance:u},e=t?e:e.toLowerCase(),e=n?L(e):e,this.pattern=e,this.query=function(e,t={}){return e.split("|").map(e=>{let n=e.trim().split(N).filter(e=>e&&!!e.trim()),i=[];for(let r=0,s=n.length;r<s;r+=1){const e=n[r];let s=!1,o=-1;for(;!s&&++o<k;){const n=R[o];let r=n.isMultiMatch(e);r&&(i.push(new n(r,t)),s=!0)}if(!s)for(o=-1;++o<k;){const n=R[o];let r=n.isSingleMatch(e);if(r){i.push(new n(r,t));break}}}return i})}(this.pattern,this.options)}static condition(e,t){return t.useExtendedSearch}searchIn(e){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:n,isCaseSensitive:i,ignoreDiacritics:r}=this.options;e=i?e:e.toLowerCase(),e=r?L(e):e;let s=0,o=[],a=0;for(let c=0,u=t.length;c<u;c+=1){const i=t[c];o.length=0,s=0;for(let t=0,r=i.length;t<r;t+=1){const r=i[t],{isMatch:c,indices:u,score:h}=r.search(e);if(!c){a=0,s=0,o.length=0;break}if(s+=1,a+=h,n){const e=r.constructor.type;q.has(e)?o=[...o,...u]:o.push(u)}}if(s){let e={isMatch:!0,score:a/s};return n&&(e.indices=o),e}}return{isMatch:!1,score:1}}}const T=[];function O(e,t){for(let n=0,i=T.length;n<i;n+=1){let i=T[n];if(i.condition(e,t))return new i(e,t)}return new B(e,t)}const z="$and",j="$or",W="$path",P="$val",H=e=>!(!e[z]&&!e[j]),Q=e=>({[z]:Object.keys(e).map(t=>({[t]:e[t]}))});function U(e,t,{auto:n=!0}={}){const i=e=>{let r=Object.keys(e);const s=(e=>!!e[W])(e);if(!s&&r.length>1&&!H(e))return i(Q(e));if((e=>!o(e)&&h(e)&&!H(e))(e)){const i=s?e[W]:r[0],o=s?e[P]:e[i];if(!a(o))throw new Error((e=>`Invalid value for key ${e}`)(i));const c={keyId:C(i),pattern:o};return n&&(c.searcher=O(o,t)),c}let c={children:[],operator:r[0]};return r.forEach(t=>{const n=e[t];o(n)&&n.forEach(e=>{c.children.push(i(e))})}),c};return H(e)||(e=Q(e)),i(e)}function V(e,t){const n=e.matches;t.matches=[],l(n)&&n.forEach(e=>{if(!l(e.indices)||!e.indices.length)return;const{indices:n,value:i}=e;let r={indices:n,value:i};e.key&&(r.key=e.key.src),e.idx>-1&&(r.refIndex=e.idx),t.matches.push(r)})}function K(e,t){t.score=e.score}class G{constructor(e,t={},n){this.options={...y,...t},this.options.useExtendedSearch,this._keyStore=new p(this.options.keys),this.setCollection(e,n)}setCollection(e,t){if(this._docs=e,t&&!(t instanceof M))throw new Error("Incorrect 'index' type");this._myIndex=t||F(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){l(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const t=[];for(let n=0,i=this._docs.length;n<i;n+=1){const r=this._docs[n];e(r,n)&&(this.removeAt(n),n-=1,i-=1,t.push(r))}return t}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:t=-1}={}){const{includeMatches:n,includeScore:i,shouldSort:r,sortFn:s,ignoreFieldNorm:o}=this.options;let u=a(e)?a(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return function(e,{ignoreFieldNorm:t=y.ignoreFieldNorm}){e.forEach(e=>{let n=1;e.matches.forEach(({key:e,norm:i,score:r})=>{const s=e?e.weight:null;n*=Math.pow(0===r&&s?Number.EPSILON:r,(s||1)*(t?1:i))}),e.score=n})}(u,{ignoreFieldNorm:o}),r&&u.sort(s),c(t)&&t>-1&&(u=u.slice(0,t)),function(e,t,{includeMatches:n=y.includeMatches,includeScore:i=y.includeScore}={}){const r=[];return n&&r.push(V),i&&r.push(K),e.map(e=>{const{idx:n}=e,i={item:t[n],refIndex:n};return r.length&&r.forEach(t=>{t(e,i)}),i})}(u,this._docs,{includeMatches:n,includeScore:i})}_searchStringList(e){const t=O(e,this.options),{records:n}=this._myIndex,i=[];return n.forEach(({v:e,i:n,n:r})=>{if(!l(e))return;const{isMatch:s,score:o,indices:a}=t.searchIn(e);s&&i.push({item:e,idx:n,matches:[{score:o,value:e,norm:r,indices:a}]})}),i}_searchLogical(e){const t=U(e,this.options),n=(e,t,i)=>{if(!e.children){const{keyId:n,searcher:r}=e,s=this._findMatches({key:this._keyStore.get(n),value:this._myIndex.getValueForItemAtKeyId(t,n),searcher:r});return s&&s.length?[{idx:i,item:t,matches:s}]:[]}const r=[];for(let s=0,o=e.children.length;s<o;s+=1){const o=e.children[s],a=n(o,t,i);if(a.length)r.push(...a);else if(e.operator===z)return[]}return r},i=this._myIndex.records,r={},s=[];return i.forEach(({$:e,i:i})=>{if(l(e)){let o=n(t,e,i);o.length&&(r[i]||(r[i]={idx:i,item:e,matches:[]},s.push(r[i])),o.forEach(({matches:e})=>{r[i].matches.push(...e)}))}}),s}_searchObjectList(e){const t=O(e,this.options),{keys:n,records:i}=this._myIndex,r=[];return i.forEach(({$:e,i:i})=>{if(!l(e))return;let s=[];n.forEach((n,i)=>{s.push(...this._findMatches({key:n,value:e[i],searcher:t}))}),s.length&&r.push({idx:i,item:e,matches:s})}),r}_findMatches({key:e,value:t,searcher:n}){if(!l(t))return[];let i=[];if(o(t))t.forEach(({v:t,i:r,n:s})=>{if(!l(t))return;const{isMatch:o,score:a,indices:c}=n.searchIn(t);o&&i.push({score:a,key:e,value:t,idx:r,norm:s,indices:c})});else{const{v:r,n:s}=t,{isMatch:o,score:a,indices:c}=n.searchIn(r);o&&i.push({score:a,key:e,value:r,norm:s,indices:c})}return i}}G.version="7.1.0",G.createIndex=F,G.parseIndex=function(e,{getFn:t=y.getFn,fieldNormWeight:n=y.fieldNormWeight}={}){const{keys:i,records:r}=e,s=new M({getFn:t,fieldNormWeight:n});return s.setKeys(i),s.setIndexRecords(r),s},G.config=y,G.parseQuery=U,function(...e){T.push(...e)}($);var Z={};const J={lexical:.45,semantic:.25,popularity:.15,recency:.1,personalization:.05},Y=!1,X=!1,ee=!1;function te(){const e={lexical:parseFloat(Z.SEARCH_WEIGHT_LEXICAL||String(J.lexical)),semantic:parseFloat(Z.SEARCH_WEIGHT_SEMANTIC||String(J.semantic)),popularity:parseFloat(Z.SEARCH_WEIGHT_POPULARITY||String(J.popularity)),recency:parseFloat(Z.SEARCH_WEIGHT_RECENCY||String(J.recency)),personalization:parseFloat(Z.SEARCH_WEIGHT_PERSONALIZATION||String(J.personalization))};return function(e){const t=e.lexical+e.semantic+e.popularity+e.recency+e.personalization;return Math.abs(t-1)<=.05}(e)?{weights:e,features:ne()}:{weights:J,features:ne()}}function ne(){return{ENABLE_SEMANTIC:"true"===Z.ENABLE_SEMANTIC||Y,ENABLE_PERSONALIZATION:"true"===Z.ENABLE_PERSONALIZATION||X,ENABLE_ADV_FILTERS:"true"===Z.ENABLE_ADV_FILTERS||ee}}function ie(e,t){const{lexical:n,semantic:i,popularity:r,recency:s,personalization:o}=t,a=t.normalizeScores?function(e){return{lexicalScore:re(e.lexicalScore),semanticScore:re(e.semanticScore),popularityScore:re(e.popularityScore),recencyScore:re(e.recencyScore),personalizationScore:re(e.personalizationScore)}}(e):e,c=n*a.lexicalScore+i*a.semanticScore+r*a.popularityScore+s*a.recencyScore+o*a.personalizationScore;return t.boostFactors?function(e,t,n){let i=e;n.exactMatch&&t.lexicalScore>.9&&(i*=n.exactMatch);n.highEngagement&&t.popularityScore>.8&&(i*=n.highEngagement);return Math.max(0,Math.min(1,i))}(c,e,t.boostFactors):Math.max(0,Math.min(1,c))}function re(e){return Math.max(0,Math.min(1,e))}class se{constructor(e={provider:"mock",dimensions:384}){t(this,"dimensions"),t(this,"isInitialized",!0),this.dimensions=e.dimensions||384}async generateEmbedding(e){var t;if(!e||0===e.trim().length)return new Array(this.dimensions).fill(0);const n=e.toLowerCase().trim(),i=new Array(this.dimensions),r=this.extractTextFeatures(n);for(let o=0;o<this.dimensions;o++){const e=o%n.length,s=o%r.words.length,a=n.charCodeAt(e)||0,c=(null==(t=r.words[s])?void 0:t.length)||1;let u=Math.sin(.01*a+.1*o);u+=Math.cos(.1*c+.05*o),u+=.001*r.textLength,u+=r.vowelRatio*Math.sin(.02*o),i[o]=Math.tanh(u)}const s=this.simpleHash(n);for(let o=0;o<this.dimensions;o++){const e=.1*Math.sin(s+o);i[o]=Math.tanh(i[o]+e)}return this.normalizeVector(i)}async generateBatchEmbeddings(e){const t=[];for(const n of e)t.push(await this.generateEmbedding(n));return t}getDimensions(){return this.dimensions}isReady(){return this.isInitialized}extractTextFeatures(e){const t=e.split(/\s+/).filter(e=>e.length>0),n=e.split(""),i=n.filter(e=>"aeiouเแโใไ".includes(e)).length;return{textLength:e.length,words:t,wordCount:t.length,avgWordLength:t.reduce((e,t)=>e+t.length,0)/Math.max(t.length,1),vowelRatio:i/Math.max(n.length,1),uniqueChars:new Set(n).size}}simpleHash(e){let t=0;for(let n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t&=t}return Math.abs(t)}normalizeVector(e){const t=Math.sqrt(e.reduce((e,t)=>e+t*t,0));return 0===t?e:e.map(e=>e/t)}}var oe={};const ae=new class{constructor(e=!0){t(this,"logs",[]),t(this,"maxLogs",100),this.enableConsole=e}info(e,t,n){this.log("info",e,t,n)}warn(e,t,n){this.log("warn",e,t,n)}error(e,t,n,i){this.log("error",e,t,i,n)}debug(e,t,n){"true"===oe.VITE_ENABLE_DEBUG&&this.log("debug",e,t,n)}log(e,t,n,i,r){const s={timestamp:Date.now(),level:e,component:t,message:n,data:i,error:r};if(this.logs.push(s),this.logs.length>this.maxLogs&&this.logs.shift(),this.enableConsole){new Date(s.timestamp).toISOString()}}getRecentLogs(e,t){let n=this.logs;return e&&(n=n.filter(t=>t.level===e)),t&&(n=n.filter(e=>e.component===t)),n.sort((e,t)=>t.timestamp-e.timestamp)}clear(){this.logs=[]}exportLogs(){return[...this.logs]}},ce=(e,t,n)=>ae.info(e,t,n),ue={info:(e,t)=>ae.info("semantic",e,t),warn:(e,t)=>ae.warn("semantic",e,t),error:(e,t,n)=>ae.error("semantic",e,t,n),debug:(e,t)=>ae.debug("semantic",e,t)},he={info:(e,t)=>ae.info("ranking",e,t),warn:(e,t)=>ae.warn("ranking",e,t),error:(e,t,n)=>ae.error("ranking",e,t,n),debug:(e,t)=>ae.debug("ranking",e,t)},le={info:(e,t)=>ae.info("filters",e,t),warn:(e,t)=>ae.warn("filters",e,t),error:(e,t,n)=>ae.error("filters",e,t,n),debug:(e,t)=>ae.debug("filters",e,t)};const ge=new class{constructor(e=50){t(this,"queries",[]),t(this,"queryFrequency",new Map),t(this,"maxQueries"),this.maxQueries=e}recordQuery(e){const t={...e,id:this.generateId(),timestamp:Date.now()};this.queries.push(t),this.queries.length>this.maxQueries&&this.queries.shift(),this.updateQueryFrequency(e.query)}getAggregateMetrics(){if(0===this.queries.length)return this.getEmptyMetrics();const e=this.queries.length,t=this.queries.reduce((e,t)=>e+t.durationMs,0),n=this.queries.reduce((e,t)=>e+t.resultCount,0),i=this.queries.filter(e=>e.cacheHit).length,r=this.queries.filter(e=>e.usedSemantic).length,s=this.queries.filter(e=>e.usedFilters).length,o=this.queries.reduce((e,t)=>(e[t.language]++,e),{th:0,en:0,auto:0}),a=Array.from(this.queryFrequency.values()).sort((e,t)=>t.count-e.count).slice(0,10),c=this.queries.map(e=>e.timestamp),u={start:Math.min(...c),end:Math.max(...c)};return{totalQueries:e,averageDurationMs:t/e,averageResultCount:n/e,cacheHitRate:i/e,semanticUsageRate:r/e,filterUsageRate:s/e,languageDistribution:{th:o.th/e,en:o.en/e,auto:o.auto/e},popularQueries:a,timeRange:u}}getRecentQueries(e=10){return this.queries.slice(-e).sort((e,t)=>t.timestamp-e.timestamp)}clear(){this.queries=[],this.queryFrequency.clear()}getPerformanceInsights(){const e=this.queries.filter(e=>e.durationMs>1e3).sort((e,t)=>t.durationMs-e.durationMs).slice(0,5),t=Array.from(this.queryFrequency.values()).filter(e=>e.count>=3).sort((e,t)=>t.count-e.count).slice(0,10),n=this.queries.filter(e=>e.usedSemantic),i={averageDuration:n.reduce((e,t)=>e+t.durationMs,0)/Math.max(n.length,1),averageResults:n.reduce((e,t)=>e+t.resultCount,0)/Math.max(n.length,1)},r=[];return e.length>0&&r.push("Consider optimizing slow queries or implementing caching"),this.getAggregateMetrics().cacheHitRate<.3&&r.push("Cache hit rate is low, consider adjusting cache strategy"),t.length>0&&r.push("Frequent queries detected, consider precomputing results"),{slowQueries:e,frequentQueries:t,semanticPerformance:i,recommendations:r}}updateQueryFrequency(e){const t=e.toLowerCase().trim(),n=this.queryFrequency.get(t);if(n?(n.count++,n.lastSeen=Date.now()):this.queryFrequency.set(t,{query:t,count:1,lastSeen:Date.now()}),this.queryFrequency.size>100){Array.from(this.queryFrequency.entries()).sort(([e,t],[n,i])=>t.lastSeen-i.lastSeen).slice(0,20).forEach(([e])=>this.queryFrequency.delete(e))}}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}getEmptyMetrics(){return{totalQueries:0,averageDurationMs:0,averageResultCount:0,cacheHitRate:0,semanticUsageRate:0,filterUsageRate:0,languageDistribution:{th:0,en:0,auto:0},popularQueries:[],timeRange:{start:0,end:0}}}};const de={keys:[{name:"caption",weight:.4},{name:"tags",weight:.3},{name:"location.name",weight:.2},{name:"location.nameLocal",weight:.2},{name:"user.name",weight:.1}],threshold:.4,includeScore:!0,includeMatches:!0,minMatchCharLength:2},fe={keys:[{name:"name",weight:.3},{name:"nameLocal",weight:.3},{name:"aliases",weight:.2},{name:"tags",weight:.1},{name:"province",weight:.1}],threshold:.3,includeScore:!0,includeMatches:!0,minMatchCharLength:1},pe=.4,me=.3,Ae=.2,Ce=.1;let ye=te(),Ee=null,Me=null;async function Fe(){if(ye.features.ENABLE_SEMANTIC&&!Ee)try{Ee=function(e={provider:"mock"}){return e.provider,new se(e)}({provider:"mock"}),Me=await async function(){try{return null}catch(e){return null}}(),ue.info("Phase 2 semantic search initialized",{clientReady:Ee.isReady(),indexLoaded:!!Me})}catch(e){ue.error("Failed to initialize semantic search",e),Ee=null,Me=null}}const xe=new G(r,de),Se=new G(s,fe);function we(e){const t=[e],n=e.toLowerCase();for(const[r,s]of Object.entries(i))(r.toLowerCase().includes(n)||s.aliases.some(e=>e.toLowerCase().includes(n)))&&(t.push(...s.popularPlaces),t.push(...s.commonTags));return[...new Set(t)]}function De(e){const t=e.likeCount+2*e.commentCount;return Math.min(t/3e3,1)}function Le(e){const t=(Date.now()-new Date(e.createdAt).getTime())/864e5;return Math.exp(-t/30)}async function Be(e,t,n){if(!ye.features.ENABLE_SEMANTIC||!Ee||!Me)return ve(e,t,n);try{const i=await Ee.generateEmbedding(t),r=Me.documents.find(t=>t.id===e.id&&"post"===t.type);if(!r)return ue.debug("Post not found in semantic index, using fallback",{postId:e.id}),ve(e,t,n);const s=function(e,t){if(e.length!==t.length)return ue.warn("Vector length mismatch in cosine similarity",{lengthA:e.length,lengthB:t.length}),0;if(0===e.length)return 0;let n=0,i=0,r=0;for(let o=0;o<e.length;o++)n+=e[o]*t[o],i+=e[o]*e[o],r+=t[o]*t[o];const s=Math.sqrt(i)*Math.sqrt(r);return 0===s?0:n/s}(i,r.embedding);return ue.debug("Calculated semantic similarity",{postId:e.id,similarity:s,method:"embedding"}),Math.max(0,Math.min(1,s))}catch(i){return ue.warn("Semantic scoring failed, using fallback",i,{postId:e.id}),ve(e,t,n)}}function ve(e,t,n){var i;const r=`${e.caption} ${e.tags.join(" ")} ${(null==(i=e.location)?void 0:i.name)||""}`.toLowerCase();let s=0;for(const o of n)r.includes(o.toLowerCase())&&s++;return Math.min(s/n.length,1)}function Ie(e,t,n,i,r=0){if(ye&&ye.weights){const s={lexicalScore:i,semanticScore:e,popularityScore:t,recencyScore:n,personalizationScore:r},o=ie(s,function(e,t={}){return{...e,normalizeScores:t.normalizeScores??!0,boostFactors:t.boostFactors}}(ye.weights));return he.debug("Computed hybrid score",{scores:s,finalScore:o,method:"phase2"}),o}return Ce*i+pe*e+me*t+Ae*n}function be(e){if(!e.matches)return[];const t=[];return e.matches.forEach(e=>{e.indices&&e.indices.forEach(n=>{const i=e.value.substring(n[0],n[1]+1);t.push(i)})}),[...new Set(t)]}function _e(e,t){let n=e;return t.forEach(e=>{const t=new RegExp(`(${e})`,"gi");n=n.replace(t,"<mark>$1</mark>")}),n}async function Re(e,t={}){const i=Date.now();await n(200);const{limit:r=20,language:s="auto",filters:o}=t;await Fe(),ye=te(),ce("search","Starting contextual search",{query:e,language:s,semanticEnabled:ye.features.ENABLE_SEMANTIC,filtersEnabled:!!o});const a=we(e),c=xe.search(a.join(" ")),u=[];for(const n of c.slice(0,Math.min(2*r,50))){const t=n.item,i=1-(n.score||0),r=De(t),s=Le(t),o=await Be(t,e,a),c={relevanceScore:i,popularityScore:r,recencyScore:s,semanticScore:o,finalScore:Ie(o,r,s,i,ye.features.ENABLE_PERSONALIZATION?.5:0)},h=be(n),l=_e(t.caption,h);u.push({...t,searchMetrics:c,matchedTerms:h,highlightedCaption:l})}u.sort((e,t)=>t.searchMetrics.finalScore-e.searchMetrics.finalScore);let h=u;if(o&&ye.features.ENABLE_ADV_FILTERS){const e=function(e,t){if(!e||0===e.length)return{results:[],appliedFilters:[],filteredCount:0,totalCount:0};const n=[];let i=[...e];const r=e.length;le.debug("Applying advanced filters",{originalCount:r,filters:Object.keys(t).filter(e=>void 0!==t[e])}),t.category&&t.category.length>0&&(i=i.filter(e=>!("category"in e)||t.category.includes(e.category)),n.push("category"),le.debug("Applied category filter",{categories:t.category,remaining:i.length})),t.dateRange&&(i=i.filter(e=>{if("createdAt"in e){const n=new Date(e.createdAt);return n>=t.dateRange.start&&n<=t.dateRange.end}return!0}),n.push("dateRange"),le.debug("Applied date range filter",{range:t.dateRange,remaining:i.length})),void 0!==t.hasMedia&&(i=i.filter(e=>{if("mediaUrls"in e){const n=e.mediaUrls&&e.mediaUrls.length>0;return t.hasMedia?n:!n}return!0}),n.push("hasMedia"),le.debug("Applied media filter",{hasMedia:t.hasMedia,remaining:i.length})),t.radiusKm&&t.locationId&&(le.debug("Radius filter requested but not fully implemented",{radiusKm:t.radiusKm,locationId:t.locationId}),n.push("radius")),t.locationId&&(i=i.filter(e=>"locationId"in e?e.locationId===t.locationId:"id"in e&&e.id===t.locationId),n.push("location"),le.debug("Applied location filter",{locationId:t.locationId,remaining:i.length})),void 0!==t.minRating&&(i=i.filter(e=>!("rating"in e)||e.rating>=t.minRating),n.push("rating"),le.debug("Applied rating filter",{minRating:t.minRating,remaining:i.length})),t.language&&(i=i.filter(e=>{if("nameLocal"in e){const n=Boolean(e.nameLocal);return"th"===t.language?n:!n}return!0}),n.push("language"),le.debug("Applied language filter",{language:t.language,remaining:i.length})),t.tags&&t.tags.length>0&&(i=i.filter(e=>!(!("tags"in e)||!e.tags)&&t.tags.some(t=>e.tags.some(e=>e.toLowerCase().includes(t.toLowerCase())))),n.push("tags"),le.debug("Applied tags filter",{tags:t.tags,remaining:i.length})),t.province&&(i=i.filter(e=>{var n,i;return"province"in e?null==(n=e.province)?void 0:n.toLowerCase().includes(t.province.toLowerCase()):!(!("location"in e)||!(null==(i=e.location)?void 0:i.province))&&e.location.province.toLowerCase().includes(t.province.toLowerCase())}),n.push("province"),le.debug("Applied province filter",{province:t.province,remaining:i.length})),t.maxResults&&t.maxResults>0&&(i=i.slice(0,t.maxResults),n.push("limit"));const s={results:i,appliedFilters:n,filteredCount:i.length,totalCount:r};return le.info("Advanced filters applied",{originalCount:r,filteredCount:s.filteredCount,appliedFilters:s.appliedFilters}),s}(u,o);h=e.results,le.info("Applied advanced filters",{originalCount:u.length,filteredCount:e.filteredCount,appliedFilters:e.appliedFilters})}h=h.slice(0,r);const l=Date.now()-i;var g;return g={query:e,durationMs:l,resultCount:h.length,cacheHit:!1,usedSemantic:ye.features.ENABLE_SEMANTIC&&!!Ee&&!!Me,usedFilters:!!o&&ye.features.ENABLE_ADV_FILTERS,language:s,source:"web"},ge.recordQuery(g),ce("search","Contextual search completed",{query:e,resultCount:h.length,processingTime:l,usedSemantic:ye.features.ENABLE_SEMANTIC}),{results:h,totalCount:c.length,processingTime:l,expandedTerms:a}}async function ke(e,t=10){await n(150);const i=we(e);return Se.search(i.join(" ")).slice(0,t).map(e=>e.item).sort((e,t)=>t.popularityScore-e.popularityScore)}async function Ne(e="th"){await n(50);return{th:["เกาะพีพี","ดอยสุเทพ","วัดพระแก้ว","ตลาดน้ำ","เชียงใหม่","กระบี่"],en:["Phi Phi Islands","Doi Suthep","Grand Palace","Floating Market","Chiang Mai","Krabi"]}[e]}export{ke as a,Ne as g,Re as s};
